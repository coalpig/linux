# 第1章 服务器监控指标

## CPU,内存,负载监控指标

CPU使用率

内存使用率

系统平均负载

## 磁盘监控指标

磁盘使用率

Inode使用率

磁盘读取写入IOPS(count/s)

## 网络监控指标

网络流入流出速率(bps)(bit/s)

网络流入流出数据包数(pps)(count/s)

TCP连接数(count)

# 第2章 MySQL监控指标

## MySQL存储空间使用量(MB)

|   |   |   |
|---|---|---|
|指标|单位|含义|
|relaylog_size|MByte|relay log使用量|
|redolog_size|MByte|redo log使用量|
|sys_data_size|MByte|系统数据库数据量|
|ins_size|MByte|MySQL 实例总空间使用量|
|temp_file_size|MByte|临时文件数据量|
|undolog_size|MByte|undo log使用量|
|general_log_size|MByte|常规日志使用量|
|binlog_size|MByte|binlog使用量|
|slowlog_size|MByte|slow log使用量|
|user_data_size|MByte|用户数据库数据量|

## 磁盘使用率

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.disk_usage|%|磁盘使用率|

## IOPS使用率

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.iops_usage|%|iops利用率|

## MySQL IOPS

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.iops|Count|MySQL读写次数|

## MySQL每秒读写吞吐量(B)

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.data_io_bytes_ps|Per Second|MySQL每秒读写吞吐量|

## 流量吞吐(KB)

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.bytes_received|KByte|平均每秒从所有客户端接收到的字节数|
|mysql.bytes_sent|KByte|平均每秒发送给所有客户端的字节数|

## TPS/QPS

|   |   |   |
|---|---|---|
|指标|单位|含义|
|qps|Per Second|计算公式：Queries / Uptime|
|tps|Per Second|计算公式：(Com_insert + Com_insert_select + Com_update + Com_update_multi + Com_delete_multi + Com_delete + Com_replace + Com_replace_select) / Uptime|
|DDL_ps|Per Second|每秒DDL次数|

## 会话连接

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.total_session|Count|当前全部会话|
|mysql.active_session|Count|当前活跃会话|

## 执行次数

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.insert_select|Per Second|平均每秒Insert_Select语句执行次数|
|mysql.insert_ps|Per Second|平均每秒insert语句执行次数|
|mysql.select_ps|Per Second|平均每秒select语句执行次数|
|mysql.replace_select|Per Second|平均每秒Replace_Select语句执行次数|
|mysql.update_ps|Per Second|平均每秒update语句执行次数|
|mysql.delete_ps|Per Second|平均每秒delete语句执行次数|
|mysql.replace_ps|Per Second|平均每秒replace语句执行次数|

## 临时表

|   |   |   |
|---|---|---|
|指标|单位|含义|
|Innodb_num_open_files|Count|Innodb打开文件数|
|Open_tables|Count|打开表数|
|Open_files|Count|打开的文件数|
|Created_tmp_disk_tables|Count|MySQL执行语句时在硬盘上自动创建的临时表的数量|
|Created_tmp_disk_tables_ps|Per Second|每秒创建的临时表数量|

## 线程

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.threads_connected|Count|当前全部线程数|
|mysql.threads_running|Count|当前活跃线程数|

```
mysql> SHOW STATUS LIKE 'Threads_connected';
+-------------------+-------+
| Variable_name     | Value |
+-------------------+-------+
| Threads_connected | 6     |
+-------------------+-------+
1 row in set (0.00 sec)

mysql> SHOW STATUS LIKE 'Threads_running';
+-----------------+-------+
| Variable_name   | Value |
+-----------------+-------+
| Threads_running | 1     |
+-----------------+-------+
1 row in set (0.00 sec)
```

## 连接数利用率(%/count)

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mdl_lock_session|Count|mdl锁阻塞的连接数|
|conn_usage|%|连接数利用率|

## 全表扫描

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.select_scan|Per Second|执行全表搜索查询的数量|

```
mysql> SELECT SUM(SUM_NO_INDEX_USED) AS Total_Full_Table_Scans FROM performance_schema.events_statements_summary_by_digest WHERE SUM_NO_INDEX_USED > 0 AND DIGEST_TEXT NOT LIKE '%performance_schema%';
+------------------------+
| Total_Full_Table_Scans |
+------------------------+
|                      5 |
+------------------------+
1 row in set (0.00 sec)
```

## 刷盘次数

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.innodb_data_fsyncs|Count|InnoDB 平均每秒fsync操作次数|

## InnoDB Data 读写吞吐量(KB)

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.innodb_data_written|KByte|InnoDB 平均每秒写字节数|
|mysql.innodb_data_read|KByte|InnoDB 平均每秒读字节数|

## InnoDB Buffer Pool 请求次数

|   |   |   |
|---|---|---|
|指标|单位|含义|
|mysql.innodb_buffer_pool_reads_requests|Count|InnoDB 平均每秒从Buffer Pool读取页的次数|
|mysql.innodb_buffer_pool_write_requests|Count|InnoDB 平均每秒往Buffer Pool写入页的次数|

## 行锁

|   |   |   |
|---|---|---|
|指标|单位|含义|
|innodb_row_lock_waits|Count|InnoDB 表总等待row locks次数|
|Innodb_row_lock_current_waits|Count|InnoDB 表当前等待row locks次数|
|Innodb_row_lock_time|毫秒|从系统启动到现在锁定的总时间|
|Innodb_row_lock_time_ps|毫秒|InnoDB 表每秒等待row locks时间|
|Innodb_row_lock_waits_ps|Count|InnoDB 表每秒等待row locks次数|
|innodb_row_lock_time_avg|毫秒|InnoDB 表平均等待row locks时间|

# 第3章 Redis监控指标

## 连接数（connected_clients）

- **监控项**: 监测每个节点的活跃连接数。
- **阈值**: 警告阈值可能设置在连接数接近最大连接配置的70%，严重警告设置在90%。

## 内存使用量（used_memory）

- **监控项**: 监测每个节点已使用的内存量。
- **阈值**: 警告阈值可设置在配置内存的70%，严重警告设置在90%。

## CPU使用率

- **监控项**: 监测每个Redis服务器节点的CPU使用率。
- **阈值**: 警告阈值可设置在CPU使用率达到70%，严重警告设置在90%。

## 主从同步延迟（master_repl_offset - slave_repl_offset）

- **监控项**: 监测主从数据复制的延迟。
- **阈值**: 任何显著的延迟（例如超过1秒）都应该触发警告。

## 持久化RDB和AOF状态

- **监控项**: 监测RDB和AOF的最后一次成功执行时间和状态。
- **阈值**: 如持久化操作失败，立即触发警告。

## 命令处理速率（instantaneous_ops_per_sec）

- **监控项**: 监测每秒处理的命令数量。
- **阈值**: 根据正常操作时的平均值设定基线，如果发现异常下降则触发警告。

## 拒绝连接数（rejected_connections）

- **监控项**: 监测由于达到最大连接数而被拒绝的连接数。
- **阈值**: 任何被拒绝的连接都应该触发警告。

## 键失效率（expired_keys）

- **监控项**: 监测在一定时间内键自动过期的数量。
- **阈值**: 根据历史数据设定一个平均水平，超出正常范围应触发警告。

## 日志监控

- **监控项**: 监测错误日志，寻找任何异常或错误信息。
- **阈值**: 任何错误日志条目都应触发警告。

# 第4章 Nginx监控指标

## 活跃连接数

- **说明**: 显示当前与Nginx服务器建立的活跃连接总数。
- **重要性**: 高连接数可能指示高流量或潜在的性能瓶颈。

## 请求数

- **说明**: 监控单位时间内的请求总数。
- **重要性**: 提供服务器负载的快照，有助于识别流量峰值。

## 请求处理时间

- **说明**: 客户端请求被接收到返回响应的时间。
- **重要性**: 长的处理时间可能指示后端延迟或配置问题。

## 错误率

- **说明**: 服务器错误响应（如4xx和5xx状态码）的比率。
- **重要性**: 高错误率可能指示应用问题、资源不足或攻击。

## 数据传输速率

- **说明**: Nginx服务器发送和接收数据的速率。
- **重要性**: 可用于监控网络带宽使用情况，识别潜在的传输问题。

## 内存和CPU使用率

- **说明**: Nginx进程使用的内存和CPU资源。
- **重要性**: 资源使用高可能导致性能降低或服务中断。

## 连接拒绝次数

- **说明**: 由于服务器达到配置的连接限制而被拒绝的连接数。
- **重要性**: 可能指示需要增加资源或优化配置。

## 上游连接时间

- **说明**: Nginx到上游服务器（如PHP-FPM或API服务器）的连接时间。
- **重要性**: 长时间可能指示网络问题或上游服务器性能问题。