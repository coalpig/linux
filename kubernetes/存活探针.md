存活性探针检查机制
- exec
    - 在容器内执行指定命令。如果命令退出时返回码为 0 则认为诊断成功。
- httpGet
    - 对容器的 IP 地址上指定端口和路径执行 HTTP GET 请求。如果响应的状态码大于等于 200 且小于 400，则诊断被认为是成功的。
- tcpSocket
    - 对容器的 IP 地址上的指定端口执行 TCP 检查。如果端口打开，则诊断被认为是成功的。 如果远程系统（容器）在打开连接后立即将其关闭，这算作是健康的。

命令的方式检测

启动后第一次探测延迟10秒，为了程序完整启动
```
initialDelaySeconds: 10
```

第二次开始每三秒探测一次
```
periodSeconds: 3
```

如果报错就一直重启

exec
```
apiVersion: v1
kind: Pod
metadata:
  name: probe-nginx-pod
spec:
  containers:
  - name: nginx-pod
    image: nginx
    imagePullPolicy: IfNotPresent

    volumeMounts:
    - name: nginx-data
      mountPath: /usr/share/nginx/html

    lifecycle: #生命周期
      postStart: #启动钩子，注意要和存活探针区分开来
        exec:
          command: ["/bin/sh","-c","echo start time $(date) >> /usr/share/nginx/html/time.log"]

      preStop:
        exec:
          command: ["/bin/sh","-c","echo stop time $(date) >> /usr/share/nginx/html/time.log"]
    livenessProbe: #存活探针 liveness存活的意思，probe探针的意思
      initialDelaySeconds: 10  # pod启动10秒探测一次
      periodSeconds: 3  #在执行完initialDelaySeconds的10秒探测的第一次后每3秒探测一次
      exec: #这里代表着命令探测，探测命令有没有执行成功
        command: ["/bin/sh","-c","ls /usr/share/nginx/html/time.log"] #如果文件不存在，则重启pod
        command: ["/bin/sh","-c","echo live time $(date) >> /usr/share/nginx/html/time.log"] #这里是追加到这个文件，配合postStart可以观察启动后第一次探测需要多久，之后多少秒探测一次
  volumes:
  - name: nginx-data
    hostPath:
      path: /data/nginx-data
      type: Directory
```


http

```
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  volumes:
  - name: nginx-data
    hostPath:
      path: /data/nginx-data
      type: Directory
  containers:
  - name: nginx
    image: nginx 
    imagePullPolicy: IfNotPresent

    volumeMounts:
    - name: nginx-data
      mountPath: /usr/share/nginx/html

    lifecycle:
      postStart:
        exec:
          command: ["/bin/sh","-c","echo hello > /usr/share/nginx/html/health.html"] #启动的时候输入内容到首页

    livenessProbe: #存活探针 liveness存活的意思，probe探针的意思
      httpGet:
        path: /health.html #上面已经挂载了目录，如果首先health不存在，就会报错重启pod。
        #这里的/health是会curl ip/health.html去访问，而不是直接访问pod的根目录。
        #这里也可以使用kubectl logs -f nginx查看
        #报错后会重启
		port: 80
      initialDelaySeconds: 3
      periodSeconds: 3
```

tcp

被探测的pod

```
apiVersion: v1
kind: Pod
metadata:
  name: tomcat
spec:
  containers:
  - name: tomcat-pod
    image: tomcat
    imagePullPolicy: IfNotPresent
    ports:
    - containerPort: 8080
```

探测的pod
注意要先启动探测的pod

一般都是模式不写host
只探测自己就可以了
```
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  containers:
  - name: nginx
    image: nginx 
    imagePullPolicy: IfNotPresent
    livenessProbe:
      tcpSocket:
        host: #这里写你要检测的pod的ip
        #默认是探测自己的ip
        port: 80
      initialDelaySeconds: 3
      periodSeconds: 1
```