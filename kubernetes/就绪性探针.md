有时候，应用会暂时性地无法为请求提供服务。 例如，应用在启动时可能需要加载大量的数据或配置文件，或是启动后要依赖等待外部服务。 在这种情况下，既不想杀死应用，也不想给它发送请求。 Kubernetes 提供了就绪探针来发现并缓解这些情况。 容器所在 Pod 上报还未就绪的信息，并且不接受通过 Kubernetes Service 的流量。

实验可以选择启动慢的程序

readinessProbe可以检测exec、http get状态码、tcp端口

readinessprobe和[存活探针](存活探针.md)(livenessProbe)是一样的可以是用exec

由于[存活探针](存活探针.md)使用的是pod

这里改造成使用deployment
三者只能有其中一个，并且当条件满足，也就是exec的命令满足、http状态码为200、TCP端口满足
exec

```
apiVersion: apps/v1
kind: Deployment #副本类型
metadata:
  name: nginx-exec #副本的名称
  labels:
    app: nginx-exec #副本的标签
spec:
  selector:
    matchLabels:
      app: nginx-exec #pod的标签
  template:
    metadata:
      name: nginx-exec #pod的名称
      labels:
        app: nginx-exec #pod的标签
    spec:
      containers:
      - name: nginx-pod #容器名称
        image: nginx
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 80
        volumeMounts:
        - name: nginx-data
          mountPath: /usr/share/nginx/html

        lifecycle: #生命周期
          postStart: #启动钩子，注意要和存活探针区分开来
            exec:
              command: ["/bin/sh","-c","echo start time $(date) >> /usr/share/nginx/html/time.log"]

          preStop:
            exec:
              command: ["/bin/sh","-c","echo stop time $(date) >> /usr/share/nginx/html/time.log"]
        readinessProbe: #存活探针 liveness存活的意思，probe探针的意思
          initialDelaySeconds: 10  # pod启动10秒探测一次
          periodSeconds: 3
          exec:
            command: ["/bin/sh","-c","ls /usr/share/nginx/html/time.log"] #如果文件不存在，则重启pod
            command: ["/bin/sh","-c","echo live time $(date) >> /usr/share/nginx/html/time.log"]

      volumes:
      - name: nginx-data
        hostPath:
          path: /data/nginx-data
          type: Directory
```


http
就绪性探针中的http探针可以作为apply发布运行资源配置清单的时候svc放行ip和端口使用
这个功能也可以一直探测首页是否是200如果不是
nodeport立马会关闭clusterIP的IP和端口
```
apiVersion: apps/v1
kind: Deployment #副本类型
metadata:
  name: nginx-http #副本的名称
  labels:
    app: nginx-http #副本的标签
spec:
  selector:
    matchLabels:
      app: nginx-http #pod的标签
  template:
    metadata:
      name: nginx-http #pod的名称
      labels:
        app: nginx-http #pod的标签
    spec:
      containers:
      - name: nginx-pod #容器名称
        image: nginx
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 80
        volumeMounts:
        - name: nginx-data
          mountPath: /usr/share/nginx/html
        readinessProbe: #存活探针 liveness存活的意思，probe探针的意思
          initialDelaySeconds: 10  # pod启动10秒探测一次
          periodSeconds: 3
          httpGet:
            path: /index.html
            port: 80
      volumes:
      - name: nginx-data
        hostPath:
          path: /data/nginx-data
          type: Directory

```


tcp

```
apiVersion: apps/v1
kind: Deployment #副本类型
metadata:
  name: nginx-http #副本的名称
  labels:
    app: nginx-http #副本的标签
spec:
  selector:
    matchLabels:
      app: nginx-http #pod的标签
  template:
    metadata:
      name: nginx-http #pod的名称
      labels:
        app: nginx-http #pod的标签
    spec:
      containers:
      - name: nginx-pod #容器名称
        image: nginx
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 80
        volumeMounts:
        - name: nginx-data
          mountPath: /usr/share/nginx/html
        readinessProbe: #存活探针 liveness存活的意思，probe探针的意思
          initialDelaySeconds: 10  # pod启动10秒探测一次
          periodSeconds: 3
          tcpSocket:  #探测tcp的80端口
            port: 80
      volumes:
      - name: nginx-data
        hostPath:
          path: /data/nginx-data
          type: Directory
```