

## 1.什么是主从延时

主库发生了操作，从库'很久'才跟上来，甚至一直追不上

## 2.如何监控主从延时

粗略估计：

```
show slave status \G
Seconds_Behind_Master: 0
```

准确计算：

```
日志量： 
主库binlog位置点
从relay执行的位置点
```

## 3.如何计算延时的日志量

```
show master status;
cat /data/3308/data/relay-log.info
```

## 4.主从延时的原因

### 4.1 主库可能的原因

```
外部原因: 
网络,硬件配置,主库业务繁忙,从库太多
   
主库业务繁忙 ： 
1. 拆分业务（分布式）： 组件分离  ，垂直  ， 水平 
2. 大事务的拆分 。比如，1000w 业务  拆分为 20次执行。 

内部 ： 
1. 二进制日志更新问题：
解决方案：
sync_binlog=1

2. 问题：  5.7之前的版本，没有开GTID之前，主库可以并发事务，但是dump传输时是串行。
所以会导致，事务量，大事务时会出现比较严重延时。
解决方案： 
5.6+ 版本，手工开启gtid，事务在主从的全局范围内就有了唯一性标志。
5.7+ 版本，无需手工开启，系统会自动生成匿名的GTID信息
有了GTID之后，就可以实现并发传输binlog。
但是,即使有这么多的优秀特性，我们依然需要尽可能的减少大事务，以及锁影响。
```

### 4.2 从库可能的原因

```
外部  :  
网络,从库配置低,参数设定。   

内部  ： 
IO线程： 
写relay-log  --> IO 性能。

SQL线程： 
回放 SQL 默认在非GTID模式下是串行的

解决方案： 
1. 开启GTID
```