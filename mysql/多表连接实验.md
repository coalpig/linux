
### 3.1 关系图

![](attachments/Pasted%20image%2020240904133712.png)

### 3.2 每位老师所教课程名称

```
select 
teacher.tname,course.cname
from teacher 
join course
on teacher.tno=course.tno;
```

### 3.3 统计每个学员的姓名及其学习课程的门数

```
select student.sname'学生姓名',COUNT(*)'学习门数'
from student
join sc
on student.sno=sc.sno
GROUP BY student.sno;
```

### 3.4 统计每个学员姓名及其学习课程的门数和课程名列表

关系图:

student ----> sc ----> course

语句：

```
select sname,count(*),group_concat(cname) 
from student
join sc
on student.sno = sc.sno
join course 
on sc.cno = course.cno
group by sname;
```

更严谨的写法：

```
select CONCAT(student.sname,"_",student.sno),COUNT(*),GROUP_CONCAT(course.cname)
from student 
join sc
on student.sno=sc.sno
join course 
on sc.cno=course.cno
group by student.sno;
```

### 3.5 每位老师姓名及其教的学生数量和学生名列表

关系图：

student ----> sc ----> course ---> teacher

语句：

```
select CONCAT(teacher.tname,"_",teacher.tno),COUNT(*),GROUP_CONCAT(student.sname)
from teacher 
join course
on teacher.tno=course.tno
join sc
on course.cno=sc.cno 
join student
on sc.sno=student.sno
group by teacher.tno
```

### 3.6 每位老师教所教课程的平均分

```
select CONCAT(teacher.tname,"_",teacher.tno,"_",course.cno),AVG(sc.score)
from teacher 
join course
on teacher.tno=course.tno
join sc
on course.cno=sc.cno 
group by teacher.tno , course.cno
```

### 3.7 查找学习了hesw但没学习oldguo课程的学生名

case用法：

```
select case when 1=1 then "true" end

USE mysql;
SELECT 
case
WHEN USER='root' THEN HOST END,
WHEN USER !='root' THEN 2 END
FROM mysql.user;

USE mysql;
SELECT 
CASE
WHEN USER='root' THEN HOST
WHEN USER !='root' THEN 2 END
FROM mysql.user;
```

方法1:

```
select a.sname from 
a
left join
b
on a.sname=b.sname
where b.sname is null;

select a.sname from 
(select student.sname
from teacher 
join course
on teacher.tno=course.tno
join sc
on course.cno=sc.cno 
join student
on sc.sno=student.sno
where teacher.tname = 'hesw') as a
left join 
(select student.sname  
from teacher 
join course
on teacher.tno=course.tno
join sc
on course.cno=sc.cno 
join student
on sc.sno=student.sno
where teacher.tname = 'oldguo') as b
on a.sname=b.sname
where b.sname is null
```

方法2:

```
SELECT student.`sname`,GROUP_CONCAT(teacher.`tname`)
FROM course
JOIN sc 
ON course.cno=sc.cno
JOIN student
ON sc.sno=student.sno
JOIN teacher
ON course.tno=teacher.tno
GROUP BY student.sname
HAVING GROUP_CONCAT(teacher.`tname`) LIKE '%hesw%' AND GROUP_CONCAT(teacher.`tname`) NOT LIKE '%oldguo%';
```

### 3.8 查询出只选修了一门课程的全部学生的学号和姓名

```
SELECT student.sname,student.sno,COUNT(sc.cno)
FROM sc
JOIN student
ON sc.sno=student.sno
GROUP BY sc.sno
HAVING COUNT(sc.cno)=1;
```

### 3.9 查询各科成绩最高和最低的分：以如下形式显示：课程名称，最高分，最低分

```
SELECT course.cname'课程名称',MAX(sc.`score`)'最高分',MIN(sc.`score`)'最低分'
FROM sc
JOIN course
ON sc.cno=course.cno
GROUP BY course.cname;
```

### 3.10 查询平均成绩大于85的所有学生的学号、姓名和平均成绩

```
select sc.sno,student.sname,AVG(sc.score) 
from sc
join student
on sc.sno=student.sno
group by sc.sno
having AVG(sc.score)>85;
```

### 3.11 统计每门课程:优秀(85分以上),良好(70-85),一般(60-70),不及格(小于60)的学生列表

```
select 
course.cname , 
GROUP_CONCAT(case when sc.score>=85 then student.sname end),
GROUP_CONCAT(case when sc.score>=70 and sc.score<85 then  student.sname end),
GROUP_CONCAT(case when sc.score>=60 and sc.score<70 then  student.sname end),
GROUP_CONCAT(case when sc.score<60 then  student.sname end)
from course
join sc 
on course.cno=sc.cno
join student
on sc.sno=student.sno 
group by course.cno

SELECT course.cname,
GROUP_CONCAT(CASE WHEN sc.score>=85 THEN CONCAT(student.sname,":",sc.score) END)'优秀',
GROUP_CONCAT(CASE WHEN sc.score>=75 AND sc.`score`<85 THEN CONCAT(student.sname,":",sc.score) END)'良好',
GROUP_CONCAT(CASE WHEN sc.score>=60 AND sc.`score`<75 THEN CONCAT(student.sname,":",sc.score) END)'一般'
FROM course
JOIN sc 
ON course.cno=sc.cno
JOIN student
ON sc.sno=student.sno
GROUP BY course.cname;
```

### 3.12 表别名使用

```
select 
a.cname , 
GROUP_CONCAT(case when b.score>=85 then  c.sname end),
GROUP_CONCAT(case when b.score>=70 and b.score<85 then  c.sname end),
GROUP_CONCAT(case when b.score>=60 and b.score<70 then  c.sname end),
GROUP_CONCAT(case when b.score<60 then  c.sname end)
from course as a
join sc as b 
on a.cno=b.cno
join student as c
on b.sno=c.sno 
group by a.cno
```

### 3.13 列别名

```
select 
a.cname as "课程名称" , 
GROUP_CONCAT(case when b.score>=85 then  c.sname end) as "优秀学员",
GROUP_CONCAT(case when b.score>=70 and b.score<85 then  c.sname end) as "良好学员",
GROUP_CONCAT(case when b.score>=60 and b.score<70 then  c.sname end) as "一般学员",
GROUP_CONCAT(case when b.score<60 then  c.sname end) as "不及格学员"
from course as a
join sc as b 
on a.cno=b.cno
join student as c
on b.sno=c.sno 
group by a.cno
```
