

## 1.涉及到的线程

### 1.1 主库

线程说明：

```
binlog_dump_thread
负责接收slave请求和传送主库binlog给slave
```

查看命令：

```
mysql> show processlist;
+----+------+-----------------+------+-------------+------+---------------------------------------------------------------+------------------+
| Id | User | Host            | db   | Command     | Time | State                                                         | Info             |
+----+------+-----------------+------+-------------+------+---------------------------------------------------------------+------------------+
| 32 | repl | 10.0.0.53:47726 | NULL | Binlog Dump |  284 | Master has sent all binlog to slave; waiting for more updates | NULL             |
| 33 | repl | 10.0.0.52:55250 | NULL | Binlog Dump |  280 | Master has sent all binlog to slave; waiting for more updates | NULL             |
| 34 | root | localhost       | NULL | Query       |    0 | starting                                                      | show processlist |
+----+------+-----------------+------+-------------+------+---------------------------------------------------------------+------------------+
```

### 1.2 从库

线程说明：

```
IO线程 ：
连接主库DUMP线程,请求Master日志、接收Master日志、存储日志（relay-log）。

SQL线程 
回放relaylog
```

查看命令：

```
[root@db-52 ~]# mysql -uroot -p123456 -e "show slave status\G"|grep "Running:"
            Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
```

## 2.涉及到的文件

### 2.1 主库

binlog日志文件

### 2.2 从库

relay-log 中继日志

```
命名方式： 
datadir/HOSTNAME-relay-bin.00000N

作用： 
存储获取到的binlog
```

主库信息文件

```
命名方式：  
datadir/master.info
作用： 
记录主库ip  port  user  password  binlog位置点等信息。
```

中继日志应用信息

```
命名方式： 
relay-log.info

作用： 
记录SQL 线程回放到的位置点信息。
```

## 3.画图说明主从复制原理--必须掌握--面试必问！

文字:

```
从库： Change master to IP，Port，USER，PASSWORD，binlog位置信息写入到M.info中,执行Start slave(启动SQL，IO)。
从库： 连接主库。
主库： 分配Dump_T,专门和S_IO通信。show processlist;
从库:  IO线程：IO线程请求新日志
主库:  DUMP_T 接收请求,截取日志，返回给S_IO
从库： IO线程接收到binlog,此时网络层层面返回ACK给主库。主库工作完成。
从库： IO将binlog最终写入到relaylog中，并更新M.info。IO线程工作结束。
从库:  SQL线程读R.info,获取上次执行到的位置点
从库： SQL线程向后执行新的relay-log，再次更新R.info。
```

画图：

![](attachments/Pasted%20image%2020240824203944.png)
