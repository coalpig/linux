
## 应用监控说明

prometheus的数据指标都是通过http实现的metrics接口获取到的，所以应用只需要暴露metrics接口，prometheus就可以定期的去拉取数据。

随着容器和k8s的流行，现在很多服务都自己内置了metrics接口，对于本身没有提供metrics的应用，promtheus官方也提供了很多可以直接使用的exporter来获取指标数据，比如redis_exporter,mysql_exporter等。

## 自带/metrics接口的应用检测

k8s里的coredns自带的metrics接口，所以我们可以先拿来试试手，查看croedns的配置文件可以发现提供prometheus服务采集的端口是9153。

可以看coredns的configmap

```
kubectl -n kube-system describe cm coredns 
#有一行出现自带的prometheus监控暴露服务
  prometheus :9153
```

CoreDNS的是以Pod运行在k8s集群的node节点中

```
kubectl -n kube-system get pod -l k8s-app=kube-dns -o wide # -l是选择标签
```

直接访问/metrics接口

```
curl  IP:9153/metrics
```

知道了端口，也确认了可以访问，那么接下来我们就可以编辑prometheus的配置文件来发现这个服务了。
修改配置文件就可以配置pull的规则

exporter定义了规则也就是指标

你只需要去根据规则引用指标填好数值就可以了


