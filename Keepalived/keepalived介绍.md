---
tags:
  - Keepalived
---

> [!info]- keepalived解决了什么问题
> 
> 
> 简单来说，keepalived解决了静态路由单点故障的问题。
> 
> 说人话就是给两台不同IP的服务器提供了可以自动切换的虚拟IP功能。
> 
> 应用场景主要用于两台反向代理服务器之间提供可以漂移的虚拟IP，当其中一台反向代理故障时，另外一个可以继续对外提供网络服务。

> [!info]- keepalived工作流程
> 
> 
> keepalived高可用功能实现的基本原理为:
> 
> 两台主机同时安装好keepalived软件
> 
> 通过配置文件定义谁是MASTER谁是BACKUP节点
> 
> 通过配置文件定义虚拟IP
> 
> 默认谁是MASTER谁创建虚拟IP，BACKUP实时监测MASTER是否还活着
> 
> 如果MASTER挂了，BACKUP会在自己身上创建VIP
> 
> 如果BACKUP检查到MASTER又活了，他就会把自己VIP删除
> 
> 此时VIP又在MASTER身上了
> 

> [!info]- keepalived实现原理
> 
> 
> keepalived软件主要是通过VRRP协议实现高可用功能的
> 
> VRRP是Virtual Router Redundancy Protocol(虚拟路由器冗余协议)的缩写
> 
> VRRP通过竞选机制来实现虚拟路由器的功能
> 
> 所有的协议报文都是通过IP多播(Multicast)包或者单播IP地址来通信
> 
> 默认的多播地址224.0.0.18
> 

> [!info]- VIP正常工作的前提条件
> 
> 
> 1.虚拟公网IP必须是真实可用的
> 
> 2.虚拟公网IP不能重复
> 
> 3.虚拟公网IP必须和相同网段的物理网卡绑定
> 
> 4.组播地址必须是可以通讯的
> 

> [!info]- 面试如何说
> 
> 
> keepalived高可用对之间是通过VRRP通信的,因此,我从VRRP开始给您讲起.
> 
> 1.VRRP,全称Virtual Router Reduancy Protocol,中文名为虚拟路由器冗余协议,VRRP的出现是为了解决静态路由的单点故障,
> 
> 2.VRRP是通过一种竞选协议来将路由任务交给某台VRRP路由器的,
> 
> 3.VRRP用IP多播的方式,(默认多播地址 224.0.0.18)实现高可用对之间通信.
> 
> 4.工作时主节点发包,备节点接包,当备节点接收不到主节点发的包的时候,就启动接管程序接管主节点的资源.备节点可以有多个,通过优先级竞选,但一般keepalived系统运维工作中都是一对.
> 
> 5.VRRP使用了加密协议加密数据,但keepalived官方目前还是推荐用明文的方式配置认证类型和密码.
> 
> 介绍完了VRRP,接下来我在介绍一下keepalived服务的工作原理;
> 
> keepalived高可用对之间是通过VRRP进行通信的,VRRP是通过竞选机制来确定主备的,主的优先级高于备,因此,工作时会优先获得所有的资源,备节点处于等待状态,当主挂了的时候,备节点就会接管主节点的资源,然后顶替主节点对外提供服务.
> 
> 6.在keepalived服务对之间,只有作为主的服务器会一直发送VRRP广播包,告诉备他还活着,此时备不会抢占主,当主不可用时,即备监听不到主发送的广播包时,就会启动相关服务接管资源,保证业务的连续性,接管速度最快可以小于一秒
> 

